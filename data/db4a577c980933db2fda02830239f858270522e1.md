# Test info

- Name: OSDEV-1230: Smoke: Facilities. Upload a list in CSV format. >> Successful list uploading in CSV format.
- Location: /home/runner/work/open-supply-hub-e2e-tests/open-supply-hub-e2e-tests/tests/smoke.spec.ts:131:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: locator('table tbody tr:first-child')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for locator('table tbody tr:first-child')

    at /home/runner/work/open-supply-hub-e2e-tests/open-supply-hub-e2e-tests/tests/smoke.spec.ts:213:23
```

# Page snapshot

```yaml
- banner:
  - link "OS Hub":
    - /url: /
    - text: OS Hub
    - img
  - navigation:
    - link "Explore":
      - /url: /
    - button "How It Works":
      - text: How It Works
      - img
    - heading "What is OS Hub?" [level=3]
    - list:
      - listitem:
        - link "Introduction":
          - /url: https://info.opensupplyhub.org
      - listitem:
        - link "FAQs":
          - /url: https://info.opensupplyhub.org/faqs
      - listitem:
        - link "Blog":
          - /url: https://blog.opensupplyhub.org
    - heading "Who is it for?" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Brands & Retailers":
          - /url: https://info.opensupplyhub.org/brands
      - listitem:
        - text: ·
        - link "Civil Society":
          - /url: https://info.opensupplyhub.org/civil-society
      - listitem:
        - text: ·
        - link "Facilities":
          - /url: https://info.opensupplyhub.org/facilities
      - listitem:
        - text: ·
        - link "Multi-Stakeholder Initiatives":
          - /url: https://info.opensupplyhub.org/msis
      - listitem:
        - text: ·
        - link "Researchers":
          - /url: https://info.opensupplyhub.org/researchers
      - listitem:
        - text: ·
        - link "Service Providers":
          - /url: https://info.opensupplyhub.org/service-providers
    - heading "What does it cover?" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Sectors":
          - /url: https://info.opensupplyhub.org/sectors
    - heading "The Technology" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Overview":
          - /url: https://info.opensupplyhub.org/technology
      - listitem:
        - text: ·
        - link "Developer Resources":
          - /url: https://info.opensupplyhub.org/developer-resources
    - heading "Premium Features" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "API":
          - /url: https://info.opensupplyhub.org/api
      - listitem:
        - text: ·
        - link "Embedded Map":
          - /url: https://info.opensupplyhub.org/embedded-map
    - button "About Us":
      - text: About Us
      - img
    - heading "Organization" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Mission":
          - /url: https://info.opensupplyhub.org/mission
      - listitem:
        - text: ·
        - link "Supporters":
          - /url: https://info.opensupplyhub.org/supporters
      - listitem:
        - text: ·
        - link "Press":
          - /url: https://info.opensupplyhub.org/press
      - listitem:
        - text: ·
        - link "Financials":
          - /url: https://info.opensupplyhub.org/financials
      - listitem:
        - text: ·
        - link "Governance & Policies":
          - /url: https://info.opensupplyhub.org/governance-policies
    - heading "People" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Team":
          - /url: https://info.opensupplyhub.org/team
      - listitem:
        - text: ·
        - link "Board of Directors":
          - /url: https://info.opensupplyhub.org/board
      - listitem:
        - text: ·
        - link "Work with Us":
          - /url: https://info.opensupplyhub.org/work-with-us
    - heading "Connect" [level=3]
    - list:
      - listitem:
        - text: ·
        - link "Contact Us":
          - /url: https://info.opensupplyhub.org/contact-us
      - listitem:
        - link "Donate":
          - /url: https://givebutter.com/opensupplyhub2022
    - link "Resources":
      - /url: https://info.opensupplyhub.org/resources
    - button "Language":
      - text: Language
      - img
    - link "বাংলা":
      - /url: https://info.opensupplyhub.org/bangladesh
    - link "India":
      - /url: https://info.opensupplyhub.org/india
    - link "Portuguese":
      - /url: https://info.opensupplyhub.org/brasil
    - link "Türkiye":
      - /url: https://info.opensupplyhub.org/turkey
    - link "Tiếng Việt":
      - /url: https://info.opensupplyhub.org/vietnam
    - button "My Account":
      - text: My Account
      - img
    - heading [level=3]
    - list:
      - listitem:
        - link "Dashboard":
          - /url: /dashboard
    - heading [level=3]
    - list:
      - listitem:
        - link "My Facilities":
          - /url: /claimed
    - heading [level=3]
    - list:
      - listitem:
        - link "My Lists":
          - /url: /lists
    - heading [level=3]
    - list:
      - listitem:
        - link "Settings":
          - /url: /settings
    - heading [level=3]
    - list:
      - listitem:
        - button "Log Out"
    - link "Add Data":
      - /url: /contribute
- main:
  - heading "My Lists" [level=2]
  - progressbar:
    - img
- contentinfo:
  - link:
    - /url: /
    - img
  - paragraph: Open Supply Hub is established as a 501(c)(3) nonprofit organization, registered in the USA.
  - paragraph: This site was designed for low energy usage and is hosted on data centers using 100% renewable energy.
  - navigation:
    - link "Donate":
      - /url: https://givebutter.com/opensupplyhub2022
    - link "Subscribe":
      - /url: https://share.hsforms.com/1bQwXClZUTjihXk3wt1SX2Abujql
    - link "FAQs":
      - /url: https://info.opensupplyhub.org/faqs
    - link "Careers":
      - /url: https://info.opensupplyhub.org/work-with-us
    - link "Media Hub":
      - /url: https://info.opensupplyhub.org/media-hub
    - link "Blog":
      - /url: https://blog.opensupplyhub.org
    - link "Terms of Service":
      - /url: https://info.opensupplyhub.org/terms-of-service
    - link "Privacy Policy":
      - /url: https://info.opensupplyhub.org/privacy-policy
    - link "Reporting Line":
      - /url: https://opensupplyhub.allvoices.co/
    - link "Contact Us":
      - /url: https://info.opensupplyhub.org/contact-us
  - heading "Follow Us" [level=3]
  - link "LinkedIn":
    - /url: https://www.linkedin.com/company/open-supply-hub/
    - text: LinkedIn
    - img
  - link "Twitter":
    - /url: https://twitter.com/OpenSupplyHub
    - text: Twitter
    - img
  - link "YouTube":
    - /url: https://www.youtube.com/channel/UCy-66mcBwX2wlUM6kvKUrGw
    - text: YouTube
    - img
  - link "Github":
    - /url: https://github.com/opensupplyhub/pyoshub
    - text: Github
    - img
  - img
  - img
- alertdialog:
  - text: We use cookies to give you the best experience on Open Supply Hub and understand site performance. By accepting, you consent to our use of cookies and other analytics tools according to our
  - link "privacy policy":
    - /url: https://info.opensupplyhub.org/terms-of-service
  - text: .
  - button "Reject"
  - button "Accept"
```

# Test source

```ts
  113 |     expect(firstFeature.properties).toHaveProperty("name");
  114 |     expect(firstFeature.properties).toHaveProperty("address");
  115 |     expect(firstFeature.properties).toHaveProperty("country_code");
  116 |     expect(firstFeature.properties).toHaveProperty("os_id");
  117 |     expect(firstFeature.properties).toHaveProperty("country_name");
  118 |   });
  119 |
  120 |   test("Get unauthorized response from `/facilities` endpoint", async ({
  121 |     request,
  122 |   }) => {
  123 |     const response = await get(request, "/api/facilities/", {
  124 |       authenticate: false,
  125 |     });
  126 |     expect(response.status()).toBe(401);
  127 |   });
  128 | });
  129 |
  130 | test.describe("OSDEV-1230: Smoke: Facilities. Upload a list in CSV format.", () => {
  131 |   test("Successful list uploading in CSV format.", async ({ page }) => {
  132 |     const { BASE_URL } = process.env;
  133 |     await page.goto(`${BASE_URL}/contribute/multiple-locations`);
  134 |
  135 |     await expect(
  136 |       page.getByRole("heading", { name: "Contribute" })
  137 |     ).toBeVisible();
  138 |     await page
  139 |       .getByRole("link", { name: "Log in to contribute to Open Supply Hub" })
  140 |       .click();
  141 |     await expect(page.getByRole("heading", { name: "Log In" })).toBeVisible();
  142 |
  143 |     const { USER_EMAIL, USER_PASSWORD } = process.env;
  144 |     await page.getByLabel("Email").fill(USER_EMAIL!);
  145 |     await page.getByRole("textbox", { name: "Password" }).fill(USER_PASSWORD!);
  146 |     await page.getByRole("button", { name: "Log In" }).click();
  147 |
  148 |     const addDataText = "Add Data";
  149 |     page
  150 |       .locator(`div.nav-item a.button:has-text("${addDataText}")`)
  151 |       .click({ force: true });
  152 |     await expect(
  153 |       page.getByRole("heading", {
  154 |         name: "Add production location data to OS Hub",
  155 |       })
  156 |     ).toBeVisible();
  157 |
  158 |     await page
  159 |       .getByRole("button", { name: "Upload Multiple Locations" })
  160 |       .click();
  161 |     await expect(page.getByRole("heading", { name: "Upload" })).toBeVisible();
  162 |
  163 |     const nameInput = page.getByLabel("Enter the name for this facility list");
  164 |     await nameInput.fill("DO NOT APPROVE test release");
  165 |     await expect(nameInput).toHaveValue("DO NOT APPROVE test release");
  166 |
  167 |     const descriptionInput = page.getByLabel(
  168 |       "Enter a description of this facility list and include a timeframe for the list's validity"
  169 |     );
  170 |     await descriptionInput.fill("DO NOT APPROVE");
  171 |     await expect(descriptionInput).toHaveValue("DO NOT APPROVE");
  172 |
  173 |     await page
  174 |       .getByRole("button", { name: /select facility list file/i })
  175 |       .click();
  176 |
  177 |     const fileInput = page.locator("input[type='file']");
  178 |     const filePath = path.resolve(
  179 |       __dirname,
  180 |       "data/DO_NOT_APPROVE test release.csv"
  181 |     );
  182 |     await fileInput.setInputFiles(filePath);
  183 |     await expect(
  184 |       page.getByText(/DO_NOT_APPROVE test release\.csv/i)
  185 |     ).toBeVisible();
  186 |
  187 |     const submitButton = page.getByRole("button", { name: /submit/i });
  188 |     await expect(submitButton).toBeEnabled();
  189 |     await submitButton.click();
  190 |     await page.waitForLoadState("networkidle");
  191 |
  192 |     const header = page.locator("h2", {
  193 |       hasText: "Thank you for submitting your list!",
  194 |     });
  195 |     await expect(header).toBeVisible();
  196 |
  197 |     const toMainButton = page.getByRole("button", {
  198 |       name: /GO TO THE MAIN PAGE/i,
  199 |     });
  200 |     await expect(toMainButton).toBeVisible();
  201 |
  202 |     const refreshButton = page.getByRole("button", { name: /REFRESH/i });
  203 |     await expect(refreshButton).toBeVisible();
  204 |     await toMainButton.click();
  205 |
  206 |     await page.getByRole("button", { name: "My Account" }).click();
  207 |     await page.getByRole("link", { name: "My Lists" }).click();
  208 |     await expect(page.getByRole("heading", { name: "My Lists" })).toBeVisible();
  209 |     await page.waitForLoadState("networkidle");
  210 |
  211 |     // Uploaded list is visible on My Lists page
  212 |     const row = page.locator("table tbody tr:first-child");
> 213 |     await expect(row).toBeVisible();
      |                       ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
  214 |
  215 |     const headers = page.locator("table thead tr th");
  216 |     const columns = [
  217 |       {
  218 |         name: "Name",
  219 |         value: "DO NOT APPROVE test release",
  220 |       },
  221 |       {
  222 |         name: "Description",
  223 |         value: "DO NOT APPROVE",
  224 |       },
  225 |       {
  226 |         name: "File Name",
  227 |         value: "DO_NOT_APPROVE test release.csv",
  228 |       },
  229 |     ];
  230 |
  231 |     for (const [index, column] of columns.entries()) {
  232 |       await expect(headers.nth(index)).toHaveText(column.name);
  233 |       await expect(row.locator("td").nth(index)).toHaveText(column.value);
  234 |     }
  235 |   });
  236 |
  237 |   test("Upload list validation in CSV format.", async ({ page }) => {
  238 |     const { BASE_URL } = process.env;
  239 |     await page.goto(`${BASE_URL}/contribute/multiple-locations`);
  240 |
  241 |     await expect(
  242 |       page.getByRole("heading", { name: "Contribute" })
  243 |     ).toBeVisible();
  244 |     await page
  245 |       .getByRole("link", { name: "Log in to contribute to Open Supply Hub" })
  246 |       .click();
  247 |     await expect(page.getByRole("heading", { name: "Log In" })).toBeVisible();
  248 |
  249 |     // fill in login credentials
  250 |     const { USER_EMAIL, USER_PASSWORD } = process.env;
  251 |     await page.getByLabel("Email").fill(USER_EMAIL!);
  252 |     await page.getByRole("textbox", { name: "Password" }).fill(USER_PASSWORD!);
  253 |     await page.getByRole("button", { name: "Log In" }).click();
  254 |     await page.waitForLoadState("networkidle");
  255 |
  256 |     const addDataText = "Add Data";
  257 |     page
  258 |       .locator(`div.nav-item a.button:has-text("${addDataText}")`)
  259 |       .click({ force: true });
  260 |     await expect(
  261 |       page.getByRole("heading", {
  262 |         name: "Add production location data to OS Hub",
  263 |       })
  264 |     ).toBeVisible();
  265 |
  266 |     await page
  267 |       .getByRole("button", { name: "Upload Multiple Locations" })
  268 |       .click();
  269 |     await expect(page.getByRole("heading", { name: "Upload" })).toBeVisible();
  270 |
  271 |     const submitButton = page.getByRole("button", { name: /submit/i });
  272 |     await expect(submitButton).toBeEnabled();
  273 |     await submitButton.click();
  274 |
  275 |     await expect(
  276 |       page.locator(".form__field", {
  277 |         hasText: "Missing required Facility List Name.",
  278 |       })
  279 |     ).toBeVisible();
  280 |     await expect(
  281 |       page.locator(".form__field", {
  282 |         hasText: "Missing required Facility List File.",
  283 |       })
  284 |     ).toBeVisible();
  285 |
  286 |     const nameInput = page.getByLabel("Enter the name for this facility list");
  287 |     await nameInput.fill('Test name!@@%^^&*()":,./ CO. LTD');
  288 |     await expect(nameInput).toHaveValue('Test name!@@%^^&*()":,./ CO. LTD');
  289 |     await submitButton.click();
  290 |     await expect(
  291 |       page.locator(".form__field", {
  292 |         hasText:
  293 |           "The List Name you entered contains invalid characters. Allowed characters include: letters, numbers, spaces, apostrophe ( ' ), comma ( , ), hyphen ( - ), ampersand ( & ), period ( . ), parentheses ( ), and square brackets ( [] ). Characters that contain accents are not allowed.",
  294 |       })
  295 |     ).toBeVisible();
  296 |   });
  297 | });
  298 |
```